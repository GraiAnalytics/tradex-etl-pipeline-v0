# configs/base.yaml
# TradeX ETL — ENTRYPOINT
# Carga core infra + includes + datasets (wiring)
# Bronze: JSONL.gz (commit atómico) | Silver/Gold: Parquet + Iceberg | State: Postgres | TZ: UTC

environment:
  name: dev                 # dev | staging | prod
  run_mode: standard        # standard | backfill

general:
  seed: 42
  timezone: UTC
  tmp_dir: .tmp
  cache_dir: .cache

# 1) Config composition (orden importa: lo último puede sobreescribir)
includes:
  # ---- clients / source technical config
  - configs/sources/x_basic.yaml
  - configs/sources/reddit.yaml
  - configs/sources/market_alpaca.yaml
  - configs/sources/rss.yaml
  - configs/sources/youtube.yaml
  - configs/sources/sec.yaml
  - configs/sources/arxiv.yaml

  # ---- domain / universe
  - configs/domains/companies.yaml
  - configs/domains/tickers.yaml
  - configs/domains/feeds.yaml
  - configs/domains/source_tiers.yaml
  - configs/domains/labels.yaml

  # ---- rules (gold + ingestion query catalogs)
  - configs/rules/queries.yaml
  - configs/rules/events.yaml
  - configs/rules/signals.yaml
  - configs/rules/signals_map.yaml

  # ---- datasets (one file = one dataset/table)
  # Bronze
  - configs/datasets/bronze/x_posts.yaml
  - configs/datasets/bronze/market_daily_prices.yaml
  - configs/datasets/bronze/reddit_posts.yaml
  - configs/datasets/bronze/news_articles_rss.yaml
  - configs/datasets/bronze/journals_articles_rss.yaml
  - configs/datasets/bronze/sec_filings.yaml
  - configs/datasets/bronze/arxiv_papers.yaml
  - configs/datasets/bronze/youtube_comments.yaml

  # Silver
  - configs/datasets/silver/silver_entity_master.yaml
  - configs/datasets/silver/silver_social_events.yaml
  - configs/datasets/silver/silver_market_daily.yaml
  - configs/datasets/silver/curated.yaml

  # Gold
  - configs/datasets/gold/text_features.yaml
  - configs/datasets/gold/price_features.yaml
  - configs/datasets/gold/gold_baselines.yaml
  - configs/datasets/gold/gold_signals.yaml
  - configs/datasets/gold/gold_serving.yaml

  # Alerts (serving)
  - configs/alerts/alerts.yaml

# 2) State store (oficial)
state_store:
  backend: postgres             # postgres | sqlite (solo local)
  postgres:
    host_env: POSTGRES_HOST
    port_env: POSTGRES_PORT
    db_env: POSTGRES_DB
    user_env: POSTGRES_USER
    password_env: POSTGRES_PASSWORD
    schema: tradex_state
    connect_timeout_seconds: 10
  sqlite:
    path: .state/tradex_state.sqlite

# 3) Storage (oficial)
storage:
  backend: s3
  s3:
    bucket_env: S3_BUCKET
    prefix: tradex
    endpoint_env: S3_ENDPOINT        # MinIO dev; vacío o AWS en prod
    region: us-east-1
    access_key_env: S3_ACCESS_KEY
    secret_key_env: S3_SECRET_KEY
    sse:
      enabled: false                 # true en prod
      kms_key_id_env: S3_KMS_KEY_ID

  bronze:
    format: jsonl
    compression: gzip
    target_file_size_mb: 128
    min_file_size_mb: 64
    max_file_size_mb: 256
    atomic_commit:
      tmp_dirname: _tmp
      success_marker: _SUCCESS

  silver:
    format: parquet
    table_format: iceberg            # iceberg | delta | parquet
    compression: zstd
    partitioning:
      enabled: true
      default_key: event_date

  gold:
    format: parquet
    table_format: iceberg
    compression: zstd
    partitioning:
      enabled: true
      default_key: date

# 4) Logging/observability (core)
logging:
  level: INFO
  jsonl: true
  to_file: true
  path: logs/pipeline_{date}.log

observability:
  metrics:
    enabled: true
    sink: logs                      # logs | prometheus (si lo agregas)
  tracing:
    enabled: false

# 5) Late data / windows defaults (core)
late_data:
  silver_allowed_lateness_days: 7
  gold_reprocess_window_days: 30

# 6) Retention (opcional)
retention_days:
  bronze:
    default: 90
    overrides:
      x: 30
      news: 90
      journals: 365
      reddit: 90
      youtube: 90
      sec: 365
      arxiv: 365
      market: 180
  silver: 365
  gold: 365

# 7) Runtime defaults (operación)
runtime:
  compute:
    workers: 4
    use_threads: true
    fail_fast: false
  retries:
    max_attempts: 3
